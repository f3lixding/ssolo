#!/bin/bash

# Script to rename files with spaces to snake_case
# Usage: ./rename_to_snake_case.sh

# Set colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üêç Converting filenames to snake_case..."
echo

# Counter for renamed files
renamed_count=0

# Check for dry run mode
if [ "$DRY_RUN" = "1" ]; then
    echo "üîç DRY RUN MODE - No files will be renamed"
    echo
fi

# Find all files with spaces in current directory
find . -maxdepth 1 -name "* *" -type f | while read -r file; do
    # Get the directory and filename
    dir=$(dirname "$file")
    filename=$(basename "$file")
    
    # Convert to snake_case:
    # 1. Replace spaces with underscores
    # 2. Replace hyphens with underscores (convert kebab-case)
    # 3. Convert to lowercase
    # 4. Remove any multiple consecutive underscores
    new_filename=$(echo "$filename" | \
        sed 's/ /_/g' | \
        sed 's/-/_/g' | \
        tr '[:upper:]' '[:lower:]' | \
        sed 's/__*/_/g')
    
    # Construct full paths
    old_path="$file"
    new_path="$dir/$new_filename"
    
    # Check if the new filename would be different
    if [ "$filename" != "$new_filename" ]; then
        if [ "$DRY_RUN" = "1" ]; then
            # Dry run - just show what would happen
            echo -e "${YELLOW}Would rename:${NC} $filename"
            echo -e "   ${YELLOW}‚Üí${NC} $new_filename"
            ((renamed_count++))
        else
            # Check if target file already exists
            if [ -e "$new_path" ]; then
                echo -e "${RED}‚ö†Ô∏è  Skipping: $filename${NC}"
                echo -e "   Target already exists: $new_filename"
            else
                # Perform the rename
                if mv "$old_path" "$new_path"; then
                    echo -e "${GREEN}‚úÖ Renamed:${NC} $filename"
                    echo -e "   ${YELLOW}‚Üí${NC} $new_filename"
                    ((renamed_count++))
                else
                    echo -e "${RED}‚ùå Failed to rename: $filename${NC}"
                fi
            fi
        fi
        echo
    fi
done

echo "üéâ Conversion complete! Renamed $renamed_count files."

# Alternative version with dry-run option
echo
echo "üí° To preview changes without actually renaming, use:"
echo "   DRY_RUN=1 ./rename_to_snake_case.sh"
